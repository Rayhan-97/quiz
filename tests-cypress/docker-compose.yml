version: '3'
services:
  frontend: 
    image: frontend
    container_name: frontend
    environment:
      - REACT_APP_BACKEND_URL=http://backend:8080
    working_dir: /frontend
    volumes:
      - /Users/rayhan.khan/vcs/quiz/frontend-react:/frontend
    entrypoint: "npm"
    command: ["start"]

  backend:
    image: backend 
    container_name: backend

  cypress:
    image: cypress-arm64
    volumes:
      - ./:/e2e
      - /tmp/.X11-unix:/tmp/.X11-unix
    working_dir: /e2e
    container_name: cypress
    environment:
      - CYPRESS_baseUrl=http://frontend:3000
      - CYPRESS_BACKEND_URL=http://backend:8080
      # get the IP address of the host machine and allow X11 to accept
      # incoming connections from that IP address
      #   IP=$(ipconfig getifaddr en0)
      #   /usr/X11/bin/xhost + $IP
      # then pass the environment variable DISPLAY to show Cypress GUI on the host system
      #   DISPLAY=$IP:0
      - DISPLAY
    entrypoint: cypress open --project /e2e